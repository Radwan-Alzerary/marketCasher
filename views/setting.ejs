<%- include('header', { role: role }); %>
    <div id="shadedbackground" class="hidden fixed w-screen h-screen top-0 bg-black opacity-10 z-10"></div>

    <form action="/table/editable" method="POST" id="editableform"
        class="hidden fixed flex flex-col justify-center gap-5 items-center w-1/2 bg-white p-5 rounded-xl shadow-lg"
        style="left: 50%; height: 88%; top: 50%; transform: translate(-50%, -50%);z-index: 600;">
        <!-- Name Input -->
        <div class="mb-4 w-full">
            <label for="name-input" class="block text-right mb-2 text-sm font-medium text-gray-900 dark:text-white">
                الاسم
            </label>
            <input type="text" placeholder="قم بادخال اسم الصنف" name="name" id="name-input"
                class="bg-gray-50 text-right border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                required>
        </div>
        <!-- Icon Selection -->
        <div class="mb-4 w-full">
            <label class="block text-right mb-2 text-sm font-medium text-gray-900 dark:text-white">
                اختر الأيقونة
            </label>
            <div class="flex gap-4">
                <!-- Table Icon -->
                <label>
                    <input type="radio" name="icon" value="table" class="hidden" />
                    <div class="p-2 border rounded hover:bg-gray-100 cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" height="5em" version="1.1" viewBox="0 0 200 200">
                            <path fill="#000000" d="
                              M 135.91 154.10
                              C 142.29 164.91 125.53 171.84 116.48 173.72
                              Q 100.14 177.11 83.74 173.81
                              C 76.45 172.35 63.08 167.78 62.94 158.40
                              C 62.77 147.52 81.38 142.60 89.55 142.13
                              A 1.01 1.00 -1.8 0 0 90.50 141.13
                              L 90.50 98.08
                              A 1.00 0.99 -89.4 0 0 89.53 97.08
                              C 72.57 96.64 11.95 91.70 12.36 65.30
                              C 12.44 60.51 11.88 54.78 13.19 51.09
                              C 18.67 35.75 46.71 29.83 60.42 27.66
                              Q 105.78 20.46 150.68 29.82
                              C 162.44 32.27 182.44 38.91 186.77 50.60
                              C 188.39 54.97 188.05 67.96 186.41 72.18
                              C 182.68 81.81 165.05 88.78 154.80 91.25
                              Q 132.98 96.50 110.49 97.11
                              A 1.00 1.00 0.0 0 0 109.52 98.11
                              L 109.49 141.16
                              A 1.01 1.00 1.8 0 0 110.44 142.16
                              C 119.31 142.66 131.32 146.32 135.91 154.10
                              Z
                              M 181.12 51.86
                              C 174.11 39.65 147.43 34.60 134.75 32.78
                              C 113.09 29.68 90.40 29.68 68.68 32.38
                              C 54.89 34.09 40.18 37.28 27.82 43.83
                              C 18.64 48.71 14.36 56.22 24.67 63.10
                              C 35.86 70.57 50.95 73.96 64.07 75.87
                              Q 101.32 81.28 138.51 75.60
                              C 151.61 73.60 172.85 68.52 180.73 57.66
                              A 1.02 1.02 0.0 0 0 180.91 57.15
                              L 181.25 52.43
                              A 0.93 0.90 -58.8 0 0 181.12 51.86
                              Z
                              M 157.00 77.26
                              C 124.67 86.54 86.59 86.28 53.77 79.91
                              Q 43.03 77.82 32.83 73.91
                              Q 25.94 71.26 20.04 67.01
                              Q 18.06 65.58 18.47 67.99
                              Q 18.96 70.82 21.03 72.97
                              C 27.51 79.72 38.19 83.23 47.04 85.40
                              Q 74.60 92.15 103.00 91.31
                              C 126.42 90.63 155.35 89.34 176.07 75.62
                              Q 180.41 72.74 181.41 68.12
                              Q 181.94 65.71 179.88 67.08
                              Q 170.36 73.42 157.00 77.26
                              Z
                              M 103.70 98.21
                              A 0.79 0.79 0.0 0 0 102.91 97.42
                              L 97.09 97.42
                              A 0.79 0.79 0.0 0 0 96.30 98.21
                              L 96.30 154.17
                              A 0.79 0.79 0.0 0 0 97.09 154.96
                              L 102.91 154.96
                              A 0.79 0.79 0.0 0 0 103.70 154.17
                              L 103.70 98.21
                              Z
                              M 126.16 152.72
                              Q 119.09 148.74 110.85 147.95
                              A 0.99 0.99 0.0 0 0 109.76 148.94
                              L 109.75 158.26
                              Q 109.75 161.01 107.00 161.00
                              L 92.81 160.98
                              Q 90.25 160.98 90.24 158.01
                              L 90.24 148.94
                              A 1.00 1.00 0.0 0 0 89.13 147.95
                              Q 79.71 148.96 71.72 153.93
                              C 64.52 158.40 72.25 163.99 76.30 165.49
                              Q 94.39 172.20 114.62 168.30
                              C 120.98 167.08 140.05 160.54 126.16 152.72
                              Z" />
                        </svg>
                    </div>
                </label>
                <!-- Person Icon -->
                <label>
                    <input type="radio" name="icon" value="person" class="hidden" />
                    <div class="p-2 border rounded hover:bg-gray-100 cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" height="5em" viewBox="0 0 448 512">
                            <path
                                d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z" />
                        </svg>
                    </div>
                </label>
                <!-- PlayStation Icon -->
                <label>
                    <input type="radio" name="icon" value="playstation" class="hidden" />
                    <div class="p-2 border rounded hover:bg-gray-100 cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" height="5em"
                            viewBox="0 0 576 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                            <path
                                d="M570.9 372.3c-11.3 14.2-38.8 24.3-38.8 24.3L327 470.2v-54.3l150.9-53.8c17.1-6.1 19.8-14.8 5.8-19.4-13.9-4.6-39.1-3.3-56.2 2.9L327 381.1v-56.4c23.2-7.8 47.1-13.6 75.7-16.8 40.9-4.5 90.9 .6 130.2 15.5 44.2 14 49.2 34.7 38 48.9zm-224.4-92.5v-139c0-16.3-3-31.3-18.3-35.6-11.7-3.8-19 7.1-19 23.4v347.9l-93.8-29.8V32c39.9 7.4 98 24.9 129.2 35.4C424.1 94.7 451 128.7 451 205.2c0 74.5-46 102.8-104.5 74.6zM43.2 410.2c-45.4-12.8-53-39.5-32.3-54.8 19.1-14.2 51.7-24.9 51.7-24.9l134.5-47.8v54.5l-96.8 34.6c-17.1 6.1-19.7 14.8-5.8 19.4 13.9 4.6 39.1 3.3 56.2-2.9l46.4-16.9v48.8c-51.6 9.3-101.4 7.3-153.9-10z" />
                        </svg>
                    </div>
                </label>
                <!-- Coffee Icon -->
                <label>
                    <input type="radio" name="icon" value="coffee" class="hidden" />
                    <div class="p-2 border rounded hover:bg-gray-100 cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" height="5em"
                            viewBox="0 0 640 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                            <path
                                d="M96 64c0-17.7 14.3-32 32-32l320 0 64 0c70.7 0 128 57.3 128 128s-57.3 128-128 128l-32 0c0 53-43 96-96 96l-192 0c-53 0-96-43-96-96L96 64zM480 224l32 0c35.3 0 64-28.7 64-64s-28.7-64-64-64l-32 0 0 128zM32 416l512 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 480c-17.7 0-32-14.3-32-32s14.3-32 32-32z" />
                        </svg>
                    </div>
                </label>
            </div>
        </div>
        <!-- Color Input -->
        <div class="mb-4 w-full">
            <label for="color-input" class="block text-right mb-2 text-sm font-medium text-gray-900 dark:text-white">
                اللون
            </label>
            <input type="color" name="color" id="color-input"
                class="border-none h-10 w-full rounded-lg cursor-pointer focus:ring-blue-500 focus:border-blue-500">
        </div>
        <!-- Switches for Change Options -->
        <div class="mb-4 w-full flex justify-between items-center">
            <label class="block text-sm font-medium text-gray-900 dark:text-white">تغيير الأيقونة</label>
            <input type="checkbox" name="iconChange" class="toggle-checkbox">
        </div>
        <div class="mb-4 w-full flex justify-between items-center">
            <label class="block text-sm font-medium text-gray-900 dark:text-white">تغيير الاسم</label>
            <input type="checkbox" name="nameChange" class="toggle-checkbox">
        </div>
        <div class="mb-4 w-full flex justify-between items-center">
            <label class="block text-sm font-medium text-gray-900 dark:text-white">تغيير اللون</label>
            <input type="checkbox" name="colorChange" class="toggle-checkbox">
        </div>
        <!-- Hidden Table Category ID -->
        <input type="text" id="tablecategoryid" name="tablecategoryid" class="hidden">
        <!-- Submit Button -->
        <input type="button" class="w-full h-11 bg-green-300 hover:bg-green-400 rounded-lg cursor-pointer" value="اضافة"
            onclick="submitEditForm()">
    </form>

    <style>
        /* Styling for the toggle checkbox */
        .toggle-checkbox {
            width: 40px;
            height: 20px;
            background-color: #ccc;
            position: relative;
            appearance: none;
            outline: none;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-checkbox:checked {
            background-color: #4caf50;
        }
    </style>



    <div class="flex rounded-md  py-2 shadow-sm justify-center items-center" role="group">
        <button type="button" onclick="showDeleverySetting()"
            class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-l-md hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white">
            اعدادات الدلفري
        </button>
        <button type="button" onclick="showWorkerSetting()"
            class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white">
            اعدادات العمال
        </button>
        <button type="button" onclick="showStorgeSetting()"
            class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white">
            اعدادات المخزن
        </button>

        <!-- <button type="button" onclick="showDiscountSetting()"
            class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white">
            اعدادات الخصوم
        </button> -->
        <button type="button" onclick="showDeviceSetting()"
            class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white">
            اعدادات الاجهزة
        </button>
        <!-- <button type="button" onclick="showAdminSetting()"
            class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white">
            اعدادات الادمنية
        </button> -->
        <button type="button" onclick="showTableSetting()"
            class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white">
            اعدادات الزبائن
        </button>
        <button type="button" onclick="showSystemSetting()"
            class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-r-md hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white">
            اعدادات النضام
        </button>

    </div>

    <div class="w-full p-5  overflow-auto px-5" style="height: 89%;">
        <%- include('./setting/tableSetting'); %>
            <%- include('./setting/SystemSetting'); %>
                <%- include('./setting/deleverySetting'); %>
                    <%- include('./setting/deviceSetting'); %>

    </div>

    <script>
        const handleFamiliesClick = (id) => {
            // Define the payload you want to send with the request
            const payload = {
                id: id,
            };

            // Make the POST request using fetch
            fetch("/table/Families", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(payload),
            })
                .then((response) => {
                    if (!response.ok) {
                        // Handle HTTP errors
                        throw new Error("Network response was not ok " + response.statusText);
                    }
                    return response.json();
                })
                .then((data) => {
                    // Handle success
                    console.log("Booking successful:", data);
                    // You can update the UI or state here based on the response
                })
                .catch((error) => {
                    // Handle error
                    console.error("Error booking the table:", error);
                    // You can show an error message to the user here
                });
        };
    </script>


    <script>
        function showWorkerSetting() {
            $(`#StorgeSetting`).addClass('hidden');
            $(`#DiscountSetting`).addClass('hidden');
            $(`#DeviceSetting`).addClass('hidden');
            $(`#AdminSetting`).addClass('hidden');
            $(`#TableSetting`).addClass('hidden');
            $(`#SystemSetting`).addClass('hidden');
            $(`#DeleverySetting`).addClass('hidden');
            $(`#WorkerSetting`).removeClass('hidden');

        }

        function showStorgeSetting() {
            $(`#StorgeSetting`).removeClass('hidden');
            $(`#DiscountSetting`).addClass('hidden');
            $(`#DeviceSetting`).addClass('hidden');
            $(`#AdminSetting`).addClass('hidden');
            $(`#TableSetting`).addClass('hidden');
            $(`#SystemSetting`).addClass('hidden');
            $(`#DeleverySetting`).addClass('hidden');
            $(`#contents`).addClass('hidden');

        }
        function showDiscountSetting() {
            $(`#StorgeSetting`).addClass('hidden');
            $(`#DiscountSetting`).removeClass('hidden');
            $(`#DeviceSetting`).addClass('hidden');
            $(`#AdminSetting`).addClass('hidden');
            $(`#TableSetting`).addClass('hidden');
            $(`#SystemSetting`).addClass('hidden');
            $(`#DeleverySetting`).addClass('hidden');
            $(`#contents`).addClass('hidden');

        }
        function showDeviceSetting() {
            $(`#StorgeSetting`).addClass('hidden');
            $(`#DiscountSetting`).addClass('hidden');
            $(`#DeviceSetting`).removeClass('hidden');
            $(`#AdminSetting`).addClass('hidden');
            $(`#TableSetting`).addClass('hidden');
            $(`#SystemSetting`).addClass('hidden');
            $(`#DeleverySetting`).addClass('hidden');
            $(`#contents`).addClass('hidden');

        }
        function showAdminSetting() {
            $(`#StorgeSetting`).addClass('hidden');
            $(`#DiscountSetting`).addClass('hidden');
            $(`#DeviceSetting`).addClass('hidden');
            $(`#AdminSetting`).removeClass('hidden');
            $(`#TableSetting`).addClass('hidden');
            $(`#SystemSetting`).addClass('hidden');
            $(`#DeleverySetting`).addClass('hidden');
            $(`#contents`).addClass('hidden');

        }
        function showTableSetting() {
            $(`#StorgeSetting`).addClass('hidden');
            $(`#DiscountSetting`).addClass('hidden');
            $(`#DeviceSetting`).addClass('hidden');
            $(`#AdminSetting`).addClass('hidden');
            $(`#TableSetting`).removeClass('hidden');
            $(`#SystemSetting`).addClass('hidden');
            $(`#DeleverySetting`).addClass('hidden');
            $(`#contents`).addClass('hidden');

        }
        function showSystemSetting() {
            $(`#StorgeSetting`).addClass('hidden');
            $(`#DiscountSetting`).addClass('hidden');
            $(`#DeviceSetting`).addClass('hidden');
            $(`#AdminSetting`).addClass('hidden');
            $(`#TableSetting`).addClass('hidden');
            $(`#SystemSetting`).removeClass('hidden');
            $(`#DeleverySetting`).addClass('hidden');
            $(`#contents`).addClass('hidden');

        }
        function showDeleverySetting() {
            $(`#StorgeSetting`).addClass('hidden');
            $(`#DiscountSetting`).addClass('hidden');
            $(`#DeviceSetting`).addClass('hidden');
            $(`#AdminSetting`).addClass('hidden');
            $(`#TableSetting`).addClass('hidden');
            $(`#SystemSetting`).addClass('hidden');
            $(`#DeleverySetting`).removeClass('hidden');
            $(`#contents`).addClass('hidden');

        }
    </script>


    <script>

        function submitEditForm() {
            // Collect form data
            const formData = {
                tablecategoryid: document.getElementById("tablecategoryid").value,
                name: document.getElementById("name-input").value,
                color: document.getElementById("color-input").value,
                iconChange: document.querySelector("input[name='iconChange']").checked,
                nameChange: document.querySelector("input[name='nameChange']").checked,
                colorChange: document.querySelector("input[name='colorChange']").checked,
                icon: document.querySelector("input[name='icon']:checked")?.value || null // Selected icon
            };

            // Send data to the backend with fetch
            fetch("/table/editable", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(formData)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.reload(); // Reload page on success
                    } else {
                        console.error("Edit failed:", data.message);
                    }
                })
                .catch(error => {
                    console.error("Error submitting form:", error);
                });
        }


        $(document).on('click', '[id^=removetable]', function () {
            var id = this.id;
            const tableid = id.replace('removetable', '');
            fetch(`/table/${tableid}/tableremove/`, {
                method: 'DELETE',
            })
                .then(response => {
                    if (response.ok) {
                        location.reload();
                        console.log('Food item removed successfully');
                    } else {
                        throw new Error('Failed to remove food item');
                    }
                })
                .catch(error => {
                    console.error(error);
                });
        });




        $(document).on('click', '[id^=unactivetable]', function () {
            var id = this.id;
            const tableid = id.replace('unactivetable', '');
            fetch(`/table/${tableid}/active/`, {
                method: 'PATCH',
            })
                .then(response => {
                    if (response.ok) {

                        location.reload();


                        console.log('Food item removed successfully');
                    } else {
                        throw new Error('Failed to remove food item');
                    }
                }).catch(error => {
                    console.error('Error updating user:', error);
                });
        });
        const handleEditTable = (id) => {
            fetch(`/table/getOne/${id}`, {
                method: 'GET',
            })
                .then(response => response.json())
                .then(data => {
                    // Display the form and background
                    $(`#editableform`).removeClass('hidden');
                    $("#shadedbackground").show();

                    // Populate form fields with data
                    $("#tablecategoryid").val(data._id); // Assuming tablecategoryid is the ID field
                    $("#name-input").val(data.name || ''); // Set name
                    $("#icon-input").val(data.icon || ''); // Set icon
                    $("#color-input").val(data.color || '#000000'); // Set color, default to white if empty

                    // Set checkbox states based on fetched data
                    $("input[name='iconChange']").prop('checked', data.iconChange);
                    $("input[name='nameChange']").prop('checked', data.nameChange);
                    $("input[name='colorChange']").prop('checked', data.colorChange);

                    console.log("Loaded data for editing:", data); // Optional: log data for debugging
                })
                .catch(error => {
                    // Handle any errors that occurred during the request
                    console.error('Error loading table data:', error);
                });
        }

        $("#shadedbackground").on('click', () => {
            $(`#editableform`).addClass('hidden');
            $("#shadedbackground").hide();
        })





    </script>
    <%- include('footer',{currentpage:'setting'}); %>